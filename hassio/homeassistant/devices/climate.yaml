input_number:
  home_target_humidity:
    name: 'Home: Target Humidity'
    icon: mdi:water-percent
    unit_of_measurement: '%'
    mode: slider
    min: 20
    max: 50
    step: 1

input_boolean:
  climate_control:
    name: 'Allow automatic climate control'
    initial: true
    icon: mdi:thermometer-auto

automation:
  - id: home_airing_turn_off
    alias: 'Home Airing: Turn off'
    trigger:
      - platform: state
        entity_id: switch.home_airing
        from: 'off'
        to: 'on'
        for:
          minutes: 20
    action:
      - service: switch.turn_off
        entity_id: switch.home_airing

  - id: climate_anomaly_alert
    alias: 'Climate: Anomaly alert'
    trigger:
      - platform: numeric_state
        entity_id:
          - sensor.bathroom_temperature
          - sensor.bedroom_temperature
          - sensor.kitchen_temperature
          - sensor.living_room_temperature
          - sensor.wardrobe_temperature
          - sensor.workshop_temperature
        below: 17

      - platform: numeric_state
        entity_id:
          - sensor.bathroom_temperature
          - sensor.bedroom_temperature
          - sensor.kitchen_temperature
          - sensor.living_room_temperature
          - sensor.wardrobe_temperature
          - sensor.workshop_temperature
        above: 29
    action:
      - service: notify.dextor
        data:
          message: ğŸ¤¨ ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ‚ĞµĞ¼Ğ¿ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ° Ğ² Ğ´Ğ¾Ğ¼Ğµ

  - id: living_room_hot
    alias: 'Living Room: Hot'
    trigger:
      - platform: event
        event_type: yandex_intent
        event_data:
          text: ĞÑ‡ĞµĞ½ÑŒ Ğ¶Ğ°Ñ€ĞºĞ¾
          room: Ğ“Ğ¾ÑÑ‚Ğ¸Ğ½Ğ°Ñ
    action:
      - service: climate.set_temperature
        entity_id:
          - climate.bedroom_ac
          - climate.workshop_ac
        data:
          temperature: 22
          hvac_mode: cool

      - if:
          - condition: template
            value_template: >
              {{ is_state('switch.portable_fan', 'off') }}
        then:
          - service: switch.turn_on
            entity_id: switch.portable_fan

      - service: script.yandex_station_tts
        data:
          target: >
            {{ trigger.event.data.get('entity_id', 'last') }}
          text: Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒÑ Ñ‚ĞµĞ±Ñ Ğ¾Ñ…Ğ»Ğ°Ğ´Ğ¸Ñ‚ÑŒ

  - id: living_room_cold
    alias: 'Living Room: cold'
    trigger:
      - platform: event
        event_type: yandex_intent
        event_data:
          text: Ğ¯ Ğ·Ğ°Ğ¼Ñ‘Ñ€Ğ·
          room: Ğ“Ğ¾ÑÑ‚Ğ¸Ğ½Ğ°Ñ
    action:
      - service: climate.turn_off
        entity_id:
          - climate.bedroom_ac
          - climate.workshop_ac

      - if:
          - condition: template
            value_template: >
              {{ is_state('switch.portable_fan', 'on') }}
        then:
          - service: switch.turn_off
            entity_id: switch.portable_fan

      - service: script.yandex_station_tts
        data:
          target: >
            {{ trigger.event.data.get('entity_id', 'last') }}
          text: ĞÑƒ Ğ¸ Ğ»Ğ°Ğ´Ğ½Ğ¾

switch:
  - platform: template
    switches:
      home_airing:
        unique_id: switch.home_airing
        friendly_name: Home Airing
        icon_template: mdi:hair-dryer-outline
        value_template: >
          {{
            is_state('input_boolean.bedroom_airing_cold', 'on') and
            is_state('input_boolean.living_room_airing_cold', 'on') and
            is_state('input_boolean.workshop_airing_cold', 'on')
          }}
        turn_on:
          - service: input_boolean.turn_on
            target:
              entity_id:
                - input_boolean.bedroom_airing_cold
                - input_boolean.living_room_airing_cold
                - input_boolean.workshop_airing_cold
        turn_off:
          - service: input_boolean.turn_off
            target:
              entity_id:
                - input_boolean.bedroom_airing_cold
                - input_boolean.bedroom_airing_warm
                - input_boolean.living_room_airing_cold
                - input_boolean.living_room_airing_warm
                - input_boolean.workshop_airing_cold
                - input_boolean.workshop_airing_warm

template:
  - sensor:
      - name: Outside Temperature
        device_class: temperature
        unit_of_measurement: Â°C
        state: >
          {% set temperature = states('sensor.weather_temperature') %}
          {% if temperature in ['unavailable', 'unknown'] %}
            {% set temperature = states('sensor.bedroom_intake_fan_outdoor_temperature') %}
          {% endif %}
          {{ temperature }}
