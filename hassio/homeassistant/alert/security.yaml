automation:
  - id: all_left_recently_alert
    alias: 'All left recently alert'
    trigger:
      platform: state
      entity_id: binary_sensor.anyone_home
      from: 'on'
      to: 'off'
      for: '00:03:00'
    condition:
      - condition: state
        entity_id: lock.front_door
        state: unlocked
    action:
      - service: notify.dextor
        data:
          message: üîë –ù–∏–∫–æ–≥–æ –Ω–µ—Ç –¥–æ–º–∞, –∞ –¥–≤–µ—Ä—å –Ω–µ –∑–∞–∫—Ä—ã—Ç–∞. –°—Ç—Ä–∞—à–Ω–æ?

  - id: motion_alarm_no_one_home
    alias: 'Motion Alarm: No one home'
    trigger:
      - platform: state
        entity_id: binary_sensor.motion_anywhere
        from: 'off'
        to: 'on'
    condition:
      - condition: state
        entity_id:
          - binary_sensor.anyone_home
          - binary_sensor.anyone_near_home
        state: 'off'

      - condition: template
        value_template: >
          {{ (now() - state_attr('automation.motion_alarm_no_one_home',
                                  'last_triggered')|default(now() - timedelta(days=1), true)).total_seconds() > 600 }}
    action:
      - service: notify.dextor
        data:
          message: üëÆ –î–≤–∏–∂–µ–Ω–∏–µ –¥–æ–º–∞, —Ö–æ—Ç—è —Ç–∞–º –Ω–∏–∫–æ–≥–æ –Ω–µ—Ç? –ù–∞—Å –≥—Ä–∞–±—é—Ç! –ù—É –∏–ª–∏ –∫–æ—Ä–º—è—Ç –∫–æ—Ç–∏–∫–æ–≤.

  - id: front_door_opened_alert
    alias: 'Front Door: Opened alert'
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door
        from: 'off'
        to: 'on'
        for:
          minutes: 15

      - platform: state
        entity_id: binary_sensor.front_door
        from: 'off'
        to: 'on'
        for:
          minutes: 30
    condition:
      - condition: state
        entity_id: binary_sensor.anyone_home
        state: 'on'
    action:
      - service: script.yandex_station_tts
        data:
          target: all
          type: alert
          text: >
            {{ states.sensor.alert_greeting.state }}
            {{ [
                '–í—Ö–æ–¥–Ω–∞—è –¥–≤–µ—Ä—å –Ω–µ –∑–∞—â–µ–ª–∫–Ω—É—Ç–∞, —Å—Ö–æ–¥–∏ –ø—Ä–æ–≤–µ—Ä—å',
                '–ú—ã –∫–æ–≥–æ-—Ç–æ –∂–¥–µ–º? –í—Ö–æ–¥–Ω–∞—è –¥–≤–µ—Ä—å –Ω–µ –ø—Ä–∏–∫—Ä—ã—Ç–∞',
                '–ü—Ä–∏–∫—Ä–æ–π –≤—Ö–æ–¥–Ω—É—é –¥–≤–µ—Ä—å, –∞ —Ç–æ —É–∫—Ä–∞–¥—É—Ç!'
                ]|random
            }}

  - id: porch_door_opened_alert
    alias: 'Porch Door: Opened alert'
    trigger:
      - platform: state
        entity_id: binary_sensor.porch_door
        to: 'on'
        for:
          hours: 6

      - platform: state
        entity_id: lock.porch_door
        to: 'unlocked'
        for:
          hours: 6
    action:
      - service: notify.dextor
        data:
          message: üîë –î–≤–µ—Ä—å –Ω–∞ –∫—Ä—ã–ª—å—Ü–æ –¥–æ–ª–≥–æ –æ—Ç–∫—Ä—ã—Ç–∞. –≠—Ç–æ –≤–æ–æ–±—â–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ?!
